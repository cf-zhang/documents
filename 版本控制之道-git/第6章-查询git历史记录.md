# 第六章 查询git历史记录

##  6.1 查看git日志

git log

不带参数的git log命令的输出中，每个提交有四个部分信息：提交名称，提交人，提交日期，提交留言。前三项内容在前三行显示，第四项内容可能显示多行。

git log -p ：除了显示日志信息，还显示代码差异

git log -n 显示n条日志

git log -commit-No 显示某次提交的日志信息

## 6.2 指定查找范围

git提供了若干有效的方法来指定查找范围：

git log --since="5 hours"  最近5小时内的提交

git log --befor="5 hours" -1  查看5小时之前的最后一个提交

git log 18f822e..0bb3dfb  查看18f822e与0bb3dfb两个版本之间的日志（左开右闭）

git log 18f822e..HEAD == git log 18f822e..    后面省略则默认为HEAD

使用tag替换commit号码也是一样的

git log --pretty=format:"%h %s" 1.0..HEAD   显示提交名称的缩写以及提交留言的第一行

git log --pretty=online

另一种指定版本的常见方法是指出它和另一个版本的关系：

* ^[n]: 一个脱字号相当于回溯一个版本

> 18f822e^ 是指18f822e之前的版本，即父节点

> 18f822e^^ 是指18f822e之前的之前的版本，即祖父节点

* ~n: 波浪字符加数字是指回溯N个版本

> 18f822e~1 是指18f822e之前的版本，即父节点

> 18f822e~2 是指18f822e之前的之前的版本，即祖父节点

git log HEAD~10..HEAD

## 6.3 查看版本之间的差异

git diff 18f822e

> 显示18f822e与当前工作目录树之间的差异

git diff 1234567 7654321

> 显示两个版本库之间的差异

git diff --stat 1.0

> 获取版本之间代码量的统计方法

## 6.4 查明该向谁问责

git blame 用来查看特定代码块的历史信息，该命令的输出结果是代码块中每行代码前附加前缀信息，其中包括提交名称、提交人和提交时间

git blam -L 12,13 hello.html 指明开始结束行

git blam -L 12,+2 hello.html 指明开始行以及查看行数+ -

可以使用正则

## 6.5 跟踪内容

git blame -M original.txt 

-M参数告诉git blame检测在同一个文件内移动或复制的代码行

git blame -C -C copy.txt

-C -C参数告诉git blame查看文件之间的复制

git log -C -C -1 -p 也可以检查文件的复制

## 6.6 撤销修改

git 所有的修改都是在本地进行的，只有推入到公共版本库才能共享。既然本地版本库是自己的底盘，那么可以随意改写版本库中的历史记录，而不会影响到别人。

### 改写历史记录的危险

已经提交到共享版本库里的历史不要随意修改。

### 增补提交

1、提交的代码忘记分号或者其他语法错误

* 修改代码并暂存后，提交时加上--amend参数就可以

* git commit -C HEAD -a --amend

> -C 告诉git复用指定提交的提交留言，而不是从头再写一个

> -c 打开编辑器，在已有提交留言的基础上进行修改

* 增补提交只能针对最后一个提交，如果想更正好几个提交之前的某个错误，则使用git revert

### 翻转提交

git revert 翻转提交

git revert -n 翻转多个提交使用-n参数

翻转总是按照从新到旧的倒序来操作的，即最后的提交要先翻转，避免冲突

### 复位

git reset 以提交名做参数，默认是HEAD

支持～n 和 ^ 符号。 

git reset HEAD～3 指复位最新的三次提交

git reset HEAD^ 指复位最新的两次提交

git reset --hard HEAD  该参数会将版本库和工作目录树的内容都复位

git reset --soft HEAD 该参会会暂存已有的变更而不提交

## 6.7 重新改写历史记录

几个需要改写记录的例子：
 
* 给历史记录重新排序，让他们看起来更合理

* 将多个提交压合成一个提交

* 将一个大的提交分解为多个小提交

git rebase -i 可以完成改变历史的任务

### 重新排序提交

git rebase -i HEAD～3

编写弹出的三个提交记录的次序，保存退出编辑器之后，重拍生效

### 将多个提交压合成一个提交

git rebase -i HEAD～3

改变提交记录次序，利用sqush标记，保存退出编辑器后，压合生效。然后会弹出编辑器，编写本次提交的记录

### 将一个提交分解成多个提交

再次使用 git rebase -i HEAD～3

利用edit 字段

还需要reset，多次编辑提交以后，利用 git rebase  --continue来生效

